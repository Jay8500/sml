<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="flex justify-content-between flex-wrap">
                <div class="flex align-items-center justify-content-center w-10rem h-2rem font-bold border-round m-2">
                    Recovery Postings
                </div>
            </div>

            <p-table #dt1 [value]="crudGrid" dataKey="smtcode" [loading]="loading" [rowHover]="true"
                styleClass="p-datatable-gridlines" [showCurrentPageReport]="true" [paginator]="false"
                responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>
                            <div class="flex justify-content-between align-items-center">
                                SMT CODE
                                <p-columnFilter type="text" field="smtcode" display="menu"
                                    placeholder="Search by SML CODE"></p-columnFilter>
                            </div>
                        </th>

                        <th>
                            <div class="flex justify-content-between align-items-center">
                                Name
                                <p-columnFilter type="text" field="borrower" display="menu"
                                    placeholder="Search by name"></p-columnFilter>
                            </div>
                        </th>

                        <th>

                            <div class="flex justify-content-between align-items-center">
                                Tenure
                                <!-- <p-columnFilter type="text" field="borrower" display="menu"
                                    placeholder="Search by name"></p-columnFilter> -->
                            </div>
                        </th>

                        <th>

                            <div class="flex justify-content-between align-items-center">
                                Repay Mode
                                <!-- <p-columnFilter type="text" field="prodtypeName" display="menu"
                                    placeholder="Search by Product type"></p-columnFilter> -->
                            </div>
                        </th>

                        <th>
                            <div class="flex justify-content-between align-items-center">
                                Borrowed Amount
                                <!-- Due Amount -->
                                <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                            </div>
                        </th>
                        <!-- <th>
                            <div class="flex justify-content-between align-items-center">
                                EMI

                            </div>
                        </th> -->
                        <!-- <th>
                            <div class="flex justify-content-between align-items-center">
                                Past due -->
                        <!-- Due Amount -->
                        <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                        <!-- </div>
                        </th> -->
                        <!-- <th>

                            <div class="flex justify-content-between align-items-center">
                                Current due -->
                        <!-- Due Amount -->
                        <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                        <!-- </div>
                        </th> -->
                        <th>

                            <div class="flex justify-content-between align-items-center">
                                Total due
                                <!-- Due Amount -->
                                <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                            </div>
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center">
                                Collected Amount
                                <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                            </div>
                        </th>
                        <th>

                            <div class="flex justify-content-between align-items-center">
                                Payment Type
                                <!-- <p-columnFilter type="text" field="status" display="menu"
                                    placeholder="Search by Suriy Status"></p-columnFilter> -->
                            </div>
                        </th>
                        <th>

                            <div class="flex justify-content-between align-items-center">
                                Remarks
                                <!-- <p-columnFilter type="text" field="status" display="menu"
                                    placeholder="Search by Suriy Status"></p-columnFilter> -->
                            </div>
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center">
                                Action
                                <!-- <p-columnFilter type="text" field="status" display="menu"
                                    placeholder="Search by Suriy Status"></p-columnFilter> -->
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-customer let-cusId="rowIndex">
                    <tr>
                        <td>
                            <i class="pi pi-history" pTooltip="Payment History" *ngIf="customer.paymentcnt>0"
                                (click)="historyLookup(customer)"></i>
                            <span style="color: blue;font-size: medium;">
                                {{customer.smtcode}}
                            </span>
                        </td>
                        <td class="text-pink-500 text-xl">
                            {{customer.borrower}}
                        </td>

                        <td>
                            {{customer.tenureName}}
                        </td>
                        <td class="text-green-500 text-xl ">
                            {{customer.loanscheduleName}}
                        </td>
                        <td class="text-orange-500 text-xl text-right">
                            {{customer.loanAmountName}}
                        </td>
                        <!-- <td>
                            {{customer.emi}}
                        </td> -->
                        <td class="text-red-500 text-xl text-right">
                            {{customer.dueamount}}
                        </td>
                        <!-- <td class="text-red-500 text-xl text-right">
                            {{customer.currentDue}}
                        </td> -->
                        <!-- <td class="text-yellow-500 text-xl text-right">
                            {{customer.loanAmountName}}
                        </td> -->
                        <td>
                            <div class="text-center">
                                <input pInputText id="age1" type="text" [(ngModel)]="customer.collectedloanAmount"
                                    [pKeyFilter]="'num'" maxlength="10" (blur)="collectedAmount(customer)" />
                            </div>
                            <div>
                                <small *ngIf="customer.error  != ''">{{customer.error}}</small>
                            </div>
                        </td>
                        <td>
                            <div *ngFor="let paymentType of paymentTypeList ">
                                <input type="radio" name="test_{{cusId}}" id="1" [value]="paymentType.value"
                                    [(ngModel)]="customer.collectedPaymentType">{{paymentType.label}}
                            </div>
                        </td>
                        <td class="text-center">
                            <textarea rows="2" cols="30" pInputTextarea [(ngModel)]="customer.remarks"
                                maxlength="1054"></textarea>
                        </td>
                        <td>
                            <button pButton label="Save" class="w-full " [loading]="customer['loadings']" *ngIf="customer.paymentcnt>0"
                                [disabled]="customer.collectedloanAmount==''  ||  customer.collectedPaymentType == ''"
                                styleClass="p-button-rounded " (click)="save(customer,cusId)"></button>
                        </td>

                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="10">Recovery Postings found.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="10">Loading Recovery Postings data. Please wait.</td>
                    </tr>
                </ng-template>
            </p-table>

        </div>

    </div>
</div>


<p-toast position="top-right" [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"
    (onClose)="onMessageClose()"></p-toast>


<p-sidebar [(visible)]="sidebarVisible" [fullScreen]="true" #sidebarRef [showCloseIcon]="false">
    <ng-template pTemplate="headless">
        <div class="flex flex-column h-full">
            <div class="flex align-items-center justify-content-between px-4 pt-3 flex-shrink-0">
                <span class="inline-flex align-items-center gap-2">
                    <span class="font-semibold text-2xl text-primary">Payment History of {{ historyHeader }}</span>
                </span>
                <span>
                    <p-button type="button" (click)="closeCallback($event)" icon="pi pi-times" rounded="true"
                        outlined="true" styleClass="h-2rem w-2rem"></p-button>
                </span>
            </div>
            <div class="overflow-y-auto">


                <p-table #dt1 [value]="paymentHistory" dataKey="smtcode" [loading]="loading" [rowHover]="true"
                    rowGroupMode="rowspan" styleClass="p-datatable-gridlines" [paginator]="false"
                    responsiveLayout="scroll">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>
                                <div class="flex justify-content-between align-items-center">
                                    Borrowed Amount
                                    <!-- Due Amount -->
                                    <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                                </div>
                            </th>

                            <th>
                                <div class="flex justify-content-between align-items-center">
                                    Collected Amount
                                    <!-- <p-columnFilter type="text" field="loanamount" display="menu"
                                    placeholder="Search by Loan amount"></p-columnFilter> -->
                                </div>
                            </th>
                            <th>

                                <div class="flex justify-content-between align-items-center">
                                    Payment Type
                                    <!-- <p-columnFilter type="text" field="status" display="menu"
                                    placeholder="Search by Suriy Status"></p-columnFilter> -->
                                </div>
                            </th>
                            <th>

                                <div class="flex justify-content-between align-items-center">
                                    Remarks
                                    <!-- <p-columnFilter type="text" field="status" display="menu"
                                    placeholder="Search by Suriy Status"></p-columnFilter> -->
                                </div>
                            </th>
                            <th>

                                <div class="flex justify-content-between align-items-center">
                                    Payment Date
                                    <!-- <p-columnFilter type="text" field="status" display="menu"
                                    placeholder="Search by Suriy Status"></p-columnFilter> -->
                                </div>
                            </th>

                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer let-cusId="rowIndex" let-rowgroup="rowgroup"
                        let-rowspan="rowspan">
                        <tr>
                            <td class="text-orange-500 text-xl text-right" *ngIf="rowgroup" [attr.rowspan]="rowspan">
                                {{customer.borrwedamount}}
                            </td>
                            <td class="text-green-500 text-xl text-right">
                                {{customer.collectedAmount}}
                            </td>
                            <td class="text-orange-500 text-xl text-right">
                                {{customer.collectedPaymentType}}
                                <!-- <div *ngFor="let paymentType of paymentTypeList ">
                                    <input type="radio" name="test_{{cusId}}" id="1" [value]="paymentType.value"
                                        [disabled]=true
                                        [(ngModel)]="customer.collectedPaymentType">{{paymentType.label}}
                                </div> -->
                            </td>
                            <td>
                                {{customer.remarks}}
                            </td>
                            <td>
                                {{customer.create_dt}}
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="5">Payments.</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="loadingbody">
                        <tr>
                            <td colspan="5">Loading Payments data. Please wait.</td>
                        </tr>
                    </ng-template>
                </p-table>




            </div>
        </div>
    </ng-template>
</p-sidebar>